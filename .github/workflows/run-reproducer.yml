name: Run reproducer on each commit
on: push
jobs:
  gradle:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-java@v1
      with:
        java-version: 11
    - uses: gradle/gradle-build-action@v2
      with:
        arguments: help --info
    - name: Unshare Info
      run: unshare --help
    - name: Unshare Version
      run: unshare -V
    - name: Install updated util-linux
      run: |
          sudo apt update
          sudo apt -y install util-linux
    - name: Unshare Info Upgraded
      run: unshare --help
    - name: Unshare Version  Upgraded
      run: unshare -V
    - name: Simulate failure
      run: exec unshare --net --ipc -r /bin/bash -c "ip link set up lo; exec unshare --map-user=$UID /bin/bash -c env"
